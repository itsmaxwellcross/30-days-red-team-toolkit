"""Interactive shell interface"""

class ShellInterface:
    """Interactive shell interface with special commands"""
    
    def __init__(self, communicator, upgrader, situational_awareness):
        self.communicator = communicator
        self.upgrader = upgrader
        self.situational_awareness = situational_awareness
    
    def start(self):
        """Start interactive shell session"""
        print("\n" + "=" * 60)
        print("INTERACTIVE REVERSE SHELL")
        print("=" * 60)
        print("Commands:")
        print("  !upgrade  - Upgrade to PTY")
        print("  !info     - Run situational awareness")
        print("  !help     - Show this help")
        print("  !exit     - Close connection")
        print("-" * 60 + "\n")
        
        while True:
            try:
                command = input("shell> ")
                
                if command == '!exit':
                    print("[*] Closing connection...")
                    break
                elif command == '!help':
                    self._show_help()
                    continue
                elif command == '!upgrade':
                    self.upgrader.upgrade_to_pty()
                    continue
                elif command == '!info':
                    self.situational_awareness.run_full_recon()
                    continue
                elif not command.strip():
                    continue
                
                # Execute command
                output = self.communicator.execute_command(command, timeout=5)
                
                if output is None:
                    print("[-] Connection lost")
                    break
                elif output:
                    print(output, end='')
                    
            except KeyboardInterrupt:
                print("\n[*] Use !exit to close connection")
            except Exception as e:
                print(f"[-] Error: {e}")
                break
    
    def _show_help(self):
        """Show help message"""
        print("\nCommands:")
        print("  !upgrade  - Upgrade to PTY")
        print("  !info     - Run situational awareness")
        print("  !help     - Show this help")
        print("  !exit     - Close connection\n")