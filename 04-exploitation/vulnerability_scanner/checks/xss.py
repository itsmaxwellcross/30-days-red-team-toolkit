"""Cross-Site Scripting vulnerability check"""

from ..config import XSS_PAYLOADS
from ..utils.url_parser import parse_url_params

def check_xss(request_handler, url):
    """Test for Cross-Site Scripting (XSS) vulnerabilities"""
    print(f"[*] Testing XSS: {url}")
    
    base_url, params = parse_url_params(url)
    if not params:
        return None
    
    for param, value in params.items():
        for payload in XSS_PAYLOADS:
            test_params = params.copy()
            test_params[param] = payload
            
            response = request_handler.get(base_url, params=test_params)
            if not response:
                continue
            
            # Check if payload is reflected without encoding
            if payload in response.text:
                print(f"    [+] FOUND: XSS in parameter '{param}'")
                return {
                    'type': 'Cross-Site Scripting (XSS)',
                    'severity': 'HIGH',
                    'url': base_url,
                    'parameter': param,
                    'payload': payload
                }
    
    return None