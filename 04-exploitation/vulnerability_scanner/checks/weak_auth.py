"""Weak authentication check"""

from ..config import DEFAULT_CREDENTIALS, LOGIN_PATHS

def check_weak_authentication(request_handler, target_url):
    """Test for weak authentication (default credentials)"""
    print(f"[*] Testing Weak Authentication: {target_url}")
    
    base_url = target_url.rstrip('/')
    
    for path in LOGIN_PATHS:
        test_url = base_url + path
        
        response = request_handler.get(test_url)
        if not response or response.status_code != 200:
            continue
        
        # Try to find login form
        if 'password' in response.text.lower() and 'username' in response.text.lower():
            print(f"    [*] Found login form at {path}")
            
            # Test default credentials
            for username, password in DEFAULT_CREDENTIALS:
                data = {
                    'username': username,
                    'password': password,
                    'user': username,
                    'pass': password
                }
                
                auth_response = request_handler.post(test_url, data=data)
                if not auth_response:
                    continue
                
                # Simple check for successful login
                if auth_response.status_code == 302 or 'dashboard' in auth_response.text.lower():
                    print(f"    [+] FOUND: Default credentials {username}:{password}")
                    return {
                        'type': 'Weak Authentication',
                        'severity': 'CRITICAL',
                        'url': test_url,
                        'username': username,
                        'password': password
                    }
    
    return None